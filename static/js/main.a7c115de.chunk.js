(this["webpackJsonppixel-pixy"]=this["webpackJsonppixel-pixy"]||[]).push([[0],{25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(2),o=n.n(r),i=n(17),c=n.n(i),s=(n(25),n(1));function u(e){var t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,a=e.target.getBoundingClientRect(),r=function(e,t,n){return Math.min(n,Math.max(e,t))},o=r(t-a.left,0,a.width-1),i=r(n-a.top,0,a.height-1);return{relativeX:o/a.width,relativeY:i/a.height}}n(26);var l=function(e){var t=e.onCanvasCreated,n=e.onTouchEvent,o=e.pixelDimensions,i=Object(r.useRef)(null);Object(r.useRef)(null);Object(r.useEffect)((function(){var e=i.current;e&&t(e)}),[t]);var c=function(e){var t=i.current;t&&n(t,e)};return Object(a.jsx)("div",{className:"CanvasContainer",children:Object(a.jsxs)("div",{children:[Object(a.jsx)("canvas",{style:{backgroundSize:"".concat(100/o/2,"%")},ref:i,width:o,height:o,onTouchEnd:c,onTouchMove:c}),false]})})},h=function(e){var t=e.onClearPressed;return Object(a.jsx)("button",{onTouchEnd:t,children:"Clear Canvas"})},f=n(7),v=(n(27),function(e){var t=e.color,n=e.onTouchEnd;return Object(a.jsx)("div",{onTouchEnd:n,style:{backgroundColor:t.toHex()},className:"ColorSquare"})}),d=(n(28),function(e){var t=e.colorSelected,n=e.onColorPicked,o=Object(r.useState)([]),i=Object(s.a)(o,2),c=i[0],u=i[1];return Object(r.useEffect)((function(){var e=Object(f.a)(c);e.unshift(t),e.length>8&&(e=e.slice(0,8)),u(e)}),[t]),Object(a.jsxs)("div",{className:"ColorPickerHistory",children:["Color History",Object(a.jsx)("div",{className:"RowZero",children:c.map((function(e,t){return Object(a.jsx)(v,{onTouchEnd:function(){return n(e)},color:e},t)}))})]})}),b=(n(29),function(e){var t=e.selectedColor,n=e.onColorPicked,o=Object(r.useState)((function(){return t.toHSL()})),i=Object(s.a)(o,2),c=i[0],l=i[1];return Object(r.useEffect)((function(){var e=t.toHSL();e&&l(e)}),[t]),Object(a.jsx)("div",{className:"Wrapper",children:Object(a.jsxs)("div",{style:{backgroundColor:"hsl(".concat(c.h,", 100%, 50%)")},className:"ColorPickerSwatch",children:[Object(a.jsx)("div",{className:"Saturation",onTouchEnd:function(e){var t=u(e),a=t.relativeX,r=t.relativeY;c.s=a,c.l=(1-r)*(1-c.s/2),l(c.clone()),n(c.toRGB())},onTouchMove:function(e){var t=u(e),n=t.relativeX,a=t.relativeY;c.s=n,c.l=(1-a)*(1-c.s/2),l(c.clone())},children:Object(a.jsx)("div",{className:"Lightness"})}),Object(a.jsx)("div",{className:"Hue",onTouchEnd:function(e){var t=u(e).relativeX;c.h=360*t,l(c.clone())},onTouchMove:function(e){var t=u(e).relativeX;c.h=360*t,l(c.clone())}})]})})}),O=(n(30),function(e){var t=e.color;return Object(a.jsxs)("div",{className:"CurrentColor",children:[Object(a.jsx)("div",{children:"CurrentColor"}),Object(a.jsx)(v,{color:t})]})});function j(e){return Object(a.jsx)("select",{value:e.value,onChange:function(t){var n=t.currentTarget.selectedIndex,a=e.options[n];e.onChange(a.value)},children:e.options.map((function(e){return Object(a.jsx)("option",{value:e.value,children:e.label},e.value)}))})}n(31);var g=[{value:1,label:"1x1"},{value:8,label:"8x8"},{value:10,label:"10x10"},{value:12,label:"12x12"},{value:14,label:"14x14"},{value:16,label:"16x16"},{value:18,label:"18x18"},{value:20,label:"20x20"},{value:22,label:"22x22"},{value:24,label:"24x24"}],p=function(e){var t=e.dimension,n=e.onDimensionChange;return Object(a.jsxs)("label",{children:["Dimension",Object(a.jsx)(j,{onChange:n,options:g,value:t})]})},x=(n(32),function(e){var t=e.pixelDimensions,n=e.rootCanvas,o=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=o.current,n=null===e||void 0===e?void 0:e.getContext("2d");if(n&&e){n.clearRect(0,0,e.width,e.height),n.strokeStyle="lightgrey",n.lineWidth=1;for(var a=e.width/t,r=0;r<t;r++)n.moveTo(Math.round(r*a),0),n.lineTo(Math.round(r*a),e.height),n.stroke();for(var i=e.height/t,c=0;c<t;c++)n.moveTo(0,Math.round(c*i)),n.lineTo(e.width,Math.round(c*i)),n.stroke();return function(){n.clearRect(0,0,e.width,e.height)}}})),Object(a.jsx)("canvas",{ref:o,className:"Grid",width:n.clientWidth,height:n.clientHeight},t)}),m=n(16),y=n.n(m),C=n(18),w=function(e){var t=e.setLoadedImage;return Object(a.jsxs)("label",{children:["Upload Image",Object(a.jsx)("input",{onChange:function(){var e=Object(C.a)(y.a.mark((function e(n){var a,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Promise((function(e,t){if(n.target.files&&n.target.files[0]){var a=URL.createObjectURL(n.target.files[0]),r=new Image;r.src=a,r.onload=function(){return e(r)}}})),e.next=3,a;case 3:r=e.sent,n.target.value="",t(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),type:"file",accept:"image/*"})]})},k=function(e){var t=e.canvas;return Object(a.jsx)("a",{onTouchEnd:function(e){var n=document.createElement("canvas");n.width=window.innerWidth,n.height=window.innerWidth;var a=n.getContext("2d");a.imageSmoothingEnabled=!1,a.drawImage(t,0,0,n.width,n.height);var r=n.toDataURL("image/png");e.target.href=r},href:"/",download:"my-pixel-art.png",children:"Save"})},M=function(e){var t=e.onToggle,n=e.text;return Object(a.jsx)("button",{onTouchEnd:t,children:n})},S=n(4),R=n(3),E=n(19),T=function(){function e(t,n,a){Object(S.a)(this,e),this.hsl=void 0,this.hsl=[t,n,a]}return Object(R.a)(e,null,[{key:"fromHSLString",value:function(t){var n=t.indexOf(",")>-1?",":" ",a=t.substr(4).split(")")[0].split(n),r=a[0],o=parseFloat(a[1].substr(0,a[1].length-1))/100,i=parseFloat(a[2].substr(0,a[2].length-1))/100,c=0;return r.indexOf("deg")>-1?r=r.substr(0,r.length-3):r.indexOf("rad")>-1?c=Math.round(parseFloat(r.substr(0,r.length-3))*(180/Math.PI)):r.indexOf("turn")>-1&&(c=Math.round(360*parseFloat(r.substr(0,r.length-4)))),c>=360&&(c%=360),new e(c,o,i)}},{key:"fromRGB",value:function(t,n,a){t/=255,n/=255,a/=255;var r,o=Math.min(t,n,a),i=Math.max(t,n,a),c=i-o,s=0;return s=0===c?0:i===t?(n-a)/c%6:i===n?(a-t)/c+2:(t-n)/c+4,(s=Math.round(60*s))<0&&(s+=360),r=(i+o)/2,new e(s,0===c?0:c/(1-Math.abs(2*r-1)),r)}}]),Object(R.a)(e,[{key:"toHSLString",value:function(){var e=Object(s.a)(this.hsl,3);return"hsl("+e[0]+","+100*e[1]+"%,"+100*e[2]+"%)"}},{key:"toRGB",value:function(){return L.fromHSL.apply(L,Object(f.a)(this.hsl))}},{key:"clone",value:function(){return Object(E.a)(e,Object(f.a)(this.hsl))}},{key:"h",get:function(){return this.hsl[0]},set:function(e){this.hsl[0]=e}},{key:"s",get:function(){return this.hsl[1]},set:function(e){this.hsl[1]=e}},{key:"l",get:function(){return this.hsl[2]},set:function(e){this.hsl[2]=e}}]),e}(),L=function(){function e(t,n,a){Object(S.a)(this,e),this.rgb=void 0,this.rgb=[t,n,a]}return Object(R.a)(e,null,[{key:"fromHSL",value:function(t,n,a){if(t<0||t>359)throw new RangeError("Hue should be between 0 and 359 inclusive");if(n<0||n>1)throw new RangeError("Saturation is a percentage and should be between 0 and 1 inclusive");if(a<0||a>1)throw new RangeError("Lightness is a percentage and should be between 0 and 1 inclusive");var r=(1-Math.abs(2*a-1))*n,o=r*(1-Math.abs(t/60%2-1)),i=a-r/2,c=0,s=0,u=0;return 0<=t&&t<60?(c=r,s=o,u=0):60<=t&&t<120?(c=o,s=r,u=0):120<=t&&t<180?(c=0,s=r,u=o):180<=t&&t<240?(c=0,s=o,u=r):240<=t&&t<300?(c=o,s=0,u=r):300<=t&&t<360&&(c=r,s=0,u=o),new e(c=Math.round(255*(c+i)),s=Math.round(255*(s+i)),u=Math.round(255*(u+i)))}},{key:"fromHex",value:function(t){if(!Number.isInteger(t))throw new TypeError("Number should be an integer, got: ".concat(t));if(t<0||t>26)throw new RangeError("Number should be between 0-16777215 inclusive");var n=t.toString(16);return e.fromHexString("#"+n)}},{key:"fromRGBString",value:function(t){var n=t.indexOf(",")>-1?",":" ",a=t.substr(4).split(")")[0].split(n),r=[];for(var o in a){var i=a[o];i.indexOf("%")>-1&&(r[o]=255*Math.round(parseFloat(i.substr(0,i.length-1))/100))}return new e(r[0],r[1],r[2])}},{key:"fromHexString",value:function(t){if(7!==t.length)throw new TypeError("Hex string is not 7 characters long. Got: "+t);if("#"!==t[0])throw new TypeError("Hex color string should start with #. Got: "+t[0]);return new e(parseInt("0x"+t[1]+t[2],16),parseInt("0x"+t[3]+t[4],16),parseInt("0x"+t[5]+t[6],16))}}]),Object(R.a)(e,[{key:"toHex",value:function(){var e=Object(s.a)(this.rgb,3),t=e[0],n=e[1],a=e[2],r=t.toString(16),o=n.toString(16),i=a.toString(16);return 1===r.length&&(r="0"+r),1===o.length&&(o="0"+o),1===i.length&&(i="0"+i),"#"+r+o+i}},{key:"toHSL",value:function(){return T.fromRGB.apply(T,Object(f.a)(this.rgb))}},{key:"r",get:function(){return this.rgb[0]},set:function(e){this.rgb[0]=e}},{key:"g",get:function(){return this.rgb[1]},set:function(e){this.rgb[1]=e}},{key:"b",get:function(){return this.rgb[2]},set:function(e){this.rgb[2]=e}}],[{key:"Equals",value:function(e,t){var n=Object(s.a)(e.rgb,3),a=n[0],r=n[1],o=n[2],i=Object(s.a)(t.rgb,3),c=i[0],u=i[1],l=i[2];return a===c&&r===u&&o===l}}]),e}();L.NO_COLOR="NO_COLOR";var N,P,H=n(6),B=n(5),I=n(13),z=n(14),_=n(9);N=Symbol.iterator,P=Symbol.toStringTag;var D=function(){function e(t){if(Object(S.a)(this,e),this.map=new Map,this[P]=void 0,t){var n,a=Object(_.a)(t);try{for(a.s();!(n=a.n()).done;){var r=Object(s.a)(n.value,2),o=Object(s.a)(r[0],2),i=o[0],c=o[1],u=r[1];this.set([i,c],u)}}catch(l){a.e(l)}finally{a.f()}}}return Object(R.a)(e,[{key:"clear",value:function(){this.map.clear()}},{key:"delete",value:function(e){var t,n=Object(s.a)(e,2),a=n[0],r=n[1];return(null===(t=this.map.get(a))||void 0===t?void 0:t.delete(r))||!1}},{key:"clone",value:function(){return new e(this)}},{key:"forEach",value:function(e,t){this.toRefMap().forEach(e,t)}},{key:"toRefMap",value:function(){var e=new Map;return this.map.forEach((function(t,n,a){t.forEach((function(t,a,r){var o=[n,a];e.set(o,t)}))})),e}},{key:"get",value:function(e){var t,n=Object(s.a)(e,2),a=n[0],r=n[1];return null===(t=this.map.get(a))||void 0===t?void 0:t.get(r)}},{key:"has",value:function(e){var t,n=Object(s.a)(e,2),a=n[0],r=n[1];return(null===(t=this.map.get(a))||void 0===t?void 0:t.has(r))||!1}},{key:"set",value:function(e,t){var n=Object(s.a)(e,2),a=n[0],r=n[1];return this.map.has(a)||this.map.set(a,new Map),this.map.get(a).set(r,t),this}},{key:N,value:function(){return this.toRefMap()[Symbol.iterator]()}},{key:"entries",value:function(){return this.toRefMap().entries()}},{key:"keys",value:function(){return this.toRefMap().keys()}},{key:"values",value:function(){return this.toRefMap().values()}},{key:"toString",value:function(){var e,t=[],n=Object(_.a)(this);try{for(n.s();!(e=n.n()).done;){var a=Object(s.a)(e.value,2),r=a[0],o=a[1];t.push("".concat(r[0],", ").concat(r[1],", ").concat(o))}}catch(i){n.e(i)}finally{n.f()}return t.join("\n")}},{key:"size",get:function(){return this.toRefMap().size}}]),e}(),A=function(){function e(t){Object(S.a)(this,e),this.pixelMap=new D,this.canvas=void 0;for(var n=0;n<t;n++)for(var a=0;a<t;a++){var r=[n,a],o=L.NO_COLOR;this.pixelMap.set(r,o)}}return Object(R.a)(e,[{key:"drawToCanvas",value:function(){if(void 0===this.canvas)throw new Error("Cannot draw to canvas, no canvas set");e.DrawToCanvas(this,this.canvas)}},{key:"setCanvas",value:function(t){if(!e.AreDimensionsCompatible(this,t))throw new RangeError("PaintCanvas and HTMLCanvas should be square and the same dimensions. Got PaintCanvas: ".concat(this.dimension()," canvas: ").concat(t.width,"x").concat(t.height));this.canvas=t}},{key:"hasCanvas",value:function(){return void 0!==this.canvas}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getPixelMap",value:function(){return this.pixelMap}},{key:"setPixelMap",value:function(e){if(e.size!==this.pixelMap.size)throw new RangeError("Cannot set pixel map. Pixel maps are not the same dimensions");this.pixelMap=e.clone()}},{key:"setPixelsFromImage",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("Could not get context for canvas");t.width=e.naturalWidth,t.height=e.naturalHeight,n.drawImage(e,0,0),this.setPixelsFromCanvas(t)}},{key:"setPixelsFromCanvas",value:function(e){var t=e.getContext("2d");if(!t)throw new Error("Could not get context for canvas");var n=e.width/this.dimension(),a=e.height/this.dimension();this.mutableMap((function(e){var r=Object(s.a)(e,2),o=r[0],i=r[1],c=t.getImageData(o*n,i*a,1,1).data,u=Object(s.a)(c,4),l=u[0],h=u[1],f=u[2];return 0===u[3]?L.NO_COLOR:new L(l,h,f)}))}},{key:"clear",value:function(){this.mutableMap((function(){return L.NO_COLOR}))}},{key:"setColorAt",value:function(e,t,n){if(!this.pixelMap.has([e,t]))throw RangeError("Pixel at ".concat(e,",").concat(t," does not exist"));this.pixelMap.set([e,t],n)}},{key:"getColorAt",value:function(e,t){var n=this.pixelMap.get([e,t]);if(void 0===n)throw RangeError("Pixel at ".concat(e,",").concat(t," does not exist"));return n}},{key:"mutableMap",value:function(e){var t,n=Object(_.a)(this.pixelMap.entries());try{for(n.s();!(t=n.n()).done;){var a=Object(s.a)(t.value,2),r=a[0],o=e(r,a[1]);this.pixelMap.set(r,o)}}catch(i){n.e(i)}finally{n.f()}}},{key:"forEach",value:function(e){var t,n=Object(_.a)(this.pixelMap.entries());try{for(n.s();!(t=n.n()).done;){var a=Object(s.a)(t.value,2);e(a[0],a[1])}}catch(r){n.e(r)}finally{n.f()}}}],[{key:"DrawToCanvas",value:function(e,t){var n=t.getContext("2d");if(!n)throw new Error("Could not get context for canvas");e.forEach((function(e,t){var a=Object(s.a)(e,2),r=a[0],o=a[1];"NO_COLOR"!==t?(n.fillStyle=t.toHex(),n.fillRect(r,o,1,1)):n.clearRect(r,o,1,1)}))}},{key:"AreDimensionsCompatible",value:function(e,t){var n=t.width,a=t.height,r=e.dimension();return n===a&&r===n}}]),Object(R.a)(e,[{key:"dimension",value:function(){return Math.sqrt(this.pixelMap.size)}},{key:"touchEvent",value:function(e,t){var n=u(e),a=n.relativeX,r=n.relativeY,o=a*this.dimension(),i=r*this.dimension(),c=Math.floor(o),s=Math.floor(i),l=this.getColorAt(c,s);"NO_COLOR"===t&&"NO_COLOR"===l||(("NO_COLOR"!==t||"NO_COLOR"===l)&&("NO_COLOR"===t||"NO_COLOR"!==l)?"NO_COLOR"!==t&&"NO_COLOR"!==l&&(L.Equals(t,l)||this.setColorAt(c,s,t)):this.setColorAt(c,s,t))}}]),e}(),G=function(e){Object(I.a)(n,e);var t=Object(z.a)(n);function n(){var e;Object(S.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).redoBuffer=new Array,e}return Object(R.a)(n,[{key:"undo",value:function(){var e=this.top();return void 0!==e&&this.getBufferLength()>1&&this.redoBuffer.push(e),Object(H.a)(Object(B.a)(n.prototype),"undo",this).call(this)}},{key:"addCurrent",value:function(e){this.redoBuffer=[],Object(H.a)(Object(B.a)(n.prototype),"addCurrent",this).call(this,e)}},{key:"getUndoSize",value:function(){return Object(H.a)(Object(B.a)(n.prototype),"getUndoSize",this).call(this)}},{key:"getRedoSize",value:function(){return this.redoBuffer.length}},{key:"redoOne",value:function(){var e=this.redoBuffer.pop();return void 0!==e&&Object(H.a)(Object(B.a)(n.prototype),"addCurrent",this).call(this,e),e}},{key:"clear",value:function(){this.redoBuffer=[],Object(H.a)(Object(B.a)(n.prototype),"clear",this).call(this)}}]),n}(function(){function e(t,n){Object(S.a)(this,e),this.base=t,this.maxSize=n,this.buffer=void 0,this.buffer=[t]}return Object(R.a)(e,[{key:"top",value:function(){return this.buffer[this.buffer.length-1]}},{key:"undo",value:function(){this.buffer.pop();var e=this.buffer[this.buffer.length-1];return e||(this.buffer=[this.base],this.base)}},{key:"addCurrent",value:function(e){this.buffer.push(e),this.maxSize&&this.maxSize<this.buffer.length&&(this.buffer=this.buffer.slice(-this.maxSize-2))}},{key:"getUndoSize",value:function(){return Math.max(this.buffer.length-2,0)}},{key:"getBufferLength",value:function(){return this.buffer.length}},{key:"clear",value:function(){this.buffer=[]}}]),e}()),F=function(e){Object(I.a)(n,e);var t=Object(z.a)(n);function n(e){var a;return Object(S.a)(this,n),(a=t.call(this,e)).undoBuffer=void 0,a.undoBuffer=new G(a.getPixelMap().clone()),a}return Object(R.a)(n,[{key:"mutableMap",value:function(e){Object(H.a)(Object(B.a)(n.prototype),"mutableMap",this).call(this,e),this.undoBuffer.addCurrent(this.getPixelMap().clone())}},{key:"setColorAt",value:function(e,t,a){Object(H.a)(Object(B.a)(n.prototype),"setColorAt",this).call(this,e,t,a),this.undoBuffer.addCurrent(this.getPixelMap().clone())}},{key:"undo",value:function(){var e=this.undoBuffer.undo();this.setPixelMap(e)}},{key:"redo",value:function(){var e=this.undoBuffer.redoOne();void 0!==e&&this.setPixelMap(e)}}]),n}(A);n(34);var U=function(){var e=Object(r.useState)(1),t=Object(s.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(new L(0,0,0)),c=Object(s.a)(i,2),u=c[0],f=c[1],v=Object(r.useState)(!1),j=Object(s.a)(v,2),g=j[0],m=j[1],y=Object(r.useState)(!1),C=Object(s.a)(y,2),S=C[0],R=C[1],E=Object(r.useState)(),T=Object(s.a)(E,2),N=T[0],P=T[1],H=Object(r.useMemo)((function(){return new F(n)}),[n]);return Object(a.jsxs)("div",{className:"App",children:[S&&Object(a.jsx)(b,{selectedColor:u,onColorPicked:f}),Object(a.jsx)(l,{onCanvasCreated:function(e){P(e),H.setCanvas(e)},pixelDimensions:n,onTouchEvent:function(e,t){H.setCanvas(e),H.touchEvent(t,u),H.drawToCanvas()}}),N&&g&&Object(a.jsx)(x,{pixelDimensions:n,rootCanvas:N}),Object(a.jsx)(d,{onColorPicked:f,colorSelected:u}),Object(a.jsx)(O,{color:u}),Object(a.jsx)(w,{setLoadedImage:function(e){H.setPixelsFromImage(e),H.drawToCanvas()}}),N&&Object(a.jsx)(k,{canvas:N}),Object(a.jsx)(h,{onClearPressed:function(){H.clear(),H.hasCanvas()?H.drawToCanvas():console.warn("Tried to clear a canvas that doesn't exist")}}),Object(a.jsx)("button",{onTouchEnd:function(){H.undo(),H.drawToCanvas()},children:"Undo"}),Object(a.jsx)("button",{onTouchEnd:function(){H.redo(),H.drawToCanvas()},children:"Redo"}),Object(a.jsx)(M,{onToggle:function(){return m(!g)},text:g?"Hide Grid":"Show Grid"}),Object(a.jsx)(M,{onToggle:function(){return R(!S)},text:S?"Hide Color Picker":"Show Color Picker"}),Object(a.jsx)(p,{onDimensionChange:o,dimension:n})]})};c.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(U,{})}),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.a7c115de.chunk.js.map